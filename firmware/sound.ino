#define BUZZER_PIN 2

int notes[75][3] = { {1318,150,150},{1318,300,300},{1318,150,300},{1046,150,150},{1318,300,300},{1568,600,600},{784,600,600},{1046,450,450},{784,150,450},{659,300,450},{880,300,300},{987,150,300},{932,150,150},{880,300,300},{784,210,210},{1318,210,210},{1568,150,150},{1750,300,300},{1396,150,150},{1568,150,300},{1318,300,300},{1046,150,150},{1174,150,150},{987,450,450},{1046,450,450},{784,150,450},{659,300,450},{880,300,300},{987,150,300},{932,150,150},{880,300,300},{784,210,210},{1318,210,210},{1568,150,150},{1750,300,300},{1396,150,150},{1568,150,300},{1318,300,300},{1046,150,150},{1174,150,150},{987,450,600},{1568,150,150},{1480,150,150},{1396,150,150},{1244,300,300},{1318,150,300},{830,150,150},{880,150,150},{1046,150,300},{880,150,150},{1046,150,150},{1174,150,150},{0,0,300},{1568,150,150},{1480,150,150},{1396,150,150},{1244,300,300},{1318,150,300},{2093,300,300},{2093,150,150},{2093,600,600},{1568,150,150},{1480,150,150},{1396,150,150},{1244,300,300},{1318,150,300},{830,150,150},{880,150,150},{1046,150,300},{880,150,150},{1046,150,150},{1174,150,450},{1244,300,450},{1174,450,450},{1046,600,1200} };


byte isLoop = false;

void MIDISetup() {
  ledcAttachPin(BUZZER_PIN, 0);
  MIDIStart();
}

void nota(int fr, int d, int d2) {
#if USE_MIDI
  if (fr) {
    ledcSetup(0, fr, 8);
    ledcWrite(0, 127);
  } else {
    ledcSetup(0, 8, 8);
    ledcWrite(0, 0);
    return;
  }
  delay(d);
  if (d2)delay(d2);
#else
  return;
#endif
}

void MIDIStart() {
  nota(1700, 100, 0);
  nota(3400, 200, 0);
  nota(1700, 300, 0);
  nota(0, 0, 0);
}

void MIDIPlayRandom() {
  byte samp = random(7) + 3;
  byte offs = random(74 - samp);
  byte mu = random(7) + 3;
  for (byte i = 0; i < samp; i++) {
    int no = offs + i;
    no = random(2) == 1 ? 74 - no : no;
    nota(notes[no][0] * 2, notes[no][1] / mu, notes[no][2] / mu);
  }
  nota(0, 0, 0);
}

void MIDIPlayMelody() {
  for (byte i = 0; i < 75; i++) {
    nota(notes[i][0], notes[i][1] / 2, notes[i][2] / 2);
  }
  nota(0, 0, 0);
}

void someNoise() {
  if (mode == GAME_MODE_IDLE
    || mode == GAME_MODE_OTA
    ) return;
  if (mode > GAME_MODE_START && random(1000) == 10) {
    MIDIPlayRandom();
  }
  delay(10);
}